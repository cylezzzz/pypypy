</div>
                `).join('');

                queue.innerHTML = queueHTML;
            }
        }

        // Global helper functions
        window.selectVideoMode = function(mode) {
            if (window.videoLab) {
                window.videoLab.selectVideoMode(mode);
            }
        };

        window.addVideoStyle = function(style) {
            const promptInput = document.getElementById('videoPrompt');
            if (promptInput) {
                const current = promptInput.value.trim();
                promptInput.value = current ? `${current}, ${style}` : style;
                
                if (window.videoLab) {
                    window.videoLab.updateGenerationButton();
                }
            }
        };

        window.setVideoSize = function(width, height) {
            const widthInput = document.getElementById('videoWidth');
            const heightInput = document.getElementById('videoHeight');
            if (widthInput) widthInput.value = width;
            if (heightInput) heightInput.value = height;
        };

        window.randomVideoSeed = function() {
            const seedInput = document.getElementById('videoSeed');
            if (seedInput && window.AndioStudio && window.AndioStudio.Utils) {
                seedInput.value = window.AndioStudio.Utils.randomSeed();
            } else {
                seedInput.value = Math.floor(Math.random() * 2147483647);
            }
        };

        window.randomizeVideoSettings = function() {
            const duration = document.getElementById('videoDuration');
            const fps = document.getElementById('videoFps');
            const motion = document.getElementById('motionStrength');
            const guidance = document.getElementById('videoGuidance');
            const seed = document.getElementById('videoSeed');
            
            if (duration) duration.value = (2 + Math.random() * 6).toFixed(1);
            if (fps) fps.value = [12, 16, 20, 24][Math.floor(Math.random() * 4)];
            if (motion) motion.value = (0.3 + Math.random() * 1.2).toFixed(1);
            if (guidance) guidance.value = (5 + Math.random() * 10).toFixed(1);
            if (seed) seed.value = Math.floor(Math.random() * 2147483647);
            
            // Update sliders
            const sliders = [
                { input: 'videoDuration', range: 'durationRange' },
                { input: 'videoFps', range: 'fpsRange' },
                { input: 'motionStrength', range: 'motionRange' },
                { input: 'videoGuidance', range: 'videoGuidanceRange' }
            ];
            
            sliders.forEach(({ input, range }) => {
                const inputEl = document.getElementById(input);
                const rangeEl = document.getElementById(range);
                if (inputEl && rangeEl) {
                    rangeEl.value = inputEl.value;
                }
            });
            
            window.AndioStudio?.toast?.info('🎲 Video settings randomized') || alert('🎲 Video settings randomized');
        };

        window.resetVideoSettings = function() {
            const elements = {
                'videoPrompt': '',
                'videoNegative': '',
                'videoDuration': 6,
                'videoFps': 16,
                'motionStrength': 0.8,
                'videoGuidance': 7.5,
                'videoWidth': 1024,
                'videoHeight': 576,
                'videoSeed': '',
                'videoQuality': 'BALANCED',
                'videoBatchSize': 1
            };

            Object.entries(elements).forEach(([id, value]) => {
                const element = document.getElementById(id);
                if (element) {
                    element.value = value;
                }
            });

            // Reset sliders
            const sliders = ['durationRange', 'fpsRange', 'motionRange', 'videoGuidanceRange'];
            sliders.forEach(id => {
                const inputId = id.replace('Range', '');
                const input = document.getElementById(inputId);
                const range = document.getElementById(id);
                if (input && range) {
                    range.value = input.value;
                }
            });
            
            window.AndioStudio?.toast?.info('🔄 Video settings reset') || alert('🔄 Video settings reset');
        };

        // Video Player Functions
        window.loadVideoInPlayer = function(videoUrl, index = 0) {
            const player = document.getElementById('mainVideoPlayer');
            if (!player) return;
            
            const source = player.querySelector('source');
            if (source) {
                source.src = videoUrl;
                player.load();
                
                if (window.videoLab) {
                    window.videoLab.currentVideoIndex = index;
                    window.videoLab.updateVideoQueue();
                }
            }
        };

        window.playPause = function() {
            const player = document.getElementById('mainVideoPlayer');
            if (!player) return;
            
            if (player.paused) {
                player.play().catch(e => console.log('Play failed:', e));
            } else {
                player.pause();
            }
        };

        window.resetVideo = function() {
            const player = document.getElementById('mainVideoPlayer');
            if (player) {
                player.currentTime = 0;
                player.pause();
            }
        };

        window.toggleLoop = function() {
            const player = document.getElementById('mainVideoPlayer');
            if (player) {
                player.loop = !player.loop;
                const message = player.loop ? '🔁 Loop enabled' : '🔁 Loop disabled';
                window.AndioStudio?.toast?.info(message) || alert(message);
            }
        };

        window.toggleMute = function() {
            const player = document.getElementById('mainVideoPlayer');
            if (player) {
                player.muted = !player.muted;
                const message = player.muted ? '🔇 Muted' : '🔊 Unmuted';
                window.AndioStudio?.toast?.info(message) || alert(message);
            }
        };

        window.fullscreen = function() {
            const player = document.getElementById('mainVideoPlayer');
            if (player && player.requestFullscreen) {
                player.requestFullscreen().catch(e => console.log('Fullscreen failed:', e));
            }
        };

        // Video Analysis Functions
        window.analyzeMotion = function() {
            const player = document.getElementById('mainVideoPlayer');
            if (!player || !player.src) {
                window.AndioStudio?.toast?.warning('Please load a video first') || alert('Please load a video first');
                return;
            }
            
            window.AndioStudio?.toast?.info('📈 Motion analysis would be implemented with computer vision libraries') || alert('📈 Motion analysis feature coming soon');
        };

        window.extractFrames = function() {
            const player = document.getElementById('mainVideoPlayer');
            if (!player || !player.src) {
                window.AndioStudio?.toast?.warning('Please load a video first') || alert('Please load a video first');
                return;
            }
            
            try {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                canvas.width = player.videoWidth || 640;
                canvas.height = player.videoHeight || 480;
                
                ctx.drawImage(player, 0, 0);
                
                canvas.toBlob(blob => {
                    if (blob) {
                        const url = URL.createObjectURL(blob);
                        const timestamp = Math.floor(player.currentTime || 0);
                        const link = document.createElement('a');
                        link.href = url;
                        link.download = `frame_${timestamp}s.png`;
                        link.click();
                        URL.revokeObjectURL(url);
                        
                        window.AndioStudio?.toast?.success('🖼️ Frame extracted') || alert('🖼️ Frame extracted');
                    }
                });
            } catch (error) {
                console.error('Frame extraction failed:', error);
                window.AndioStudio?.toast?.error('Frame extraction failed') || alert('Frame extraction failed');
            }
        };

        window.generateThumbnail = function() {
            const player = document.getElementById('mainVideoPlayer');
            if (!player || !player.src) {
                window.AndioStudio?.toast?.warning('Please load a video first') || alert('Please load a video first');
                return;
            }
            
            const originalTime = player.currentTime;
            const seekTime = (player.duration || 0) / 2;
            
            const generateThumb = () => {
                try {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    canvas.width = player.videoWidth || 640;
                    canvas.height = player.videoHeight || 480;
                    
                    ctx.drawImage(player, 0, 0);
                    
                    canvas.toBlob(blob => {
                        if (blob) {
                            const url = URL.createObjectURL(blob);
                            const link = document.createElement('a');
                            link.href = url;
                            link.download = 'video_thumbnail.png';
                            link.click();
                            URL.revokeObjectURL(url);
                            
                            window.AndioStudio?.toast?.success('📸 Thumbnail generated') || alert('📸 Thumbnail generated');
                        }
                    });
                } catch (error) {
                    console.error('Thumbnail generation failed:', error);
                }
                
                player.currentTime = originalTime;
                player.removeEventListener('seeked', generateThumb);
            };
            
            player.addEventListener('seeked', generateThumb, { once: true });
            player.currentTime = seekTime;
        };

        window.optimizeVideo = function() {
            const player = document.getElementById('mainVideoPlayer');
            if (!player || !player.src) {
                window.AndioStudio?.toast?.warning('Please load a video first') || alert('Please load a video first');
                return;
            }
            
            window.AndioStudio?.toast?.info('⚡ Video optimization would be implemented with FFmpeg on server side') || alert('⚡ Video optimization feature coming soon');
        };

        // Initialize Video Lab
        document.addEventListener('DOMContentLoaded', () => {
            try {
                window.videoLab = new VideoLab();
                console.log('Video Lab initialized successfully');
            } catch (error) {
                console.error('Failed to initialize Video Lab:', error);
                // Fallback initialization
                setTimeout(() => {
                    try {
                        window.videoLab = new VideoLab();
                    } catch (e) {
                        console.error('Fallback initialization also failed:', e);
                    }
                }, 1000);
            }
        });

        // Add video-specific styles
        const videoStyles = `
            <style>
                .mode-btn {
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    padding: 16px 12px;
                    text-align: center;
                    position: relative;
                    overflow: hidden;
                    transition: all 0.3s ease;
                }
                
                .mode-btn.active {
                    background: var(--accent-gradient);
                    color: white;
                    box-shadow: var(--shadow-glow);
                    transform: translateY(-2px);
                }
                
                .mode-btn small {
                    font-size: 11px;
                    opacity: 0.8;
                    margin-top: 4px;
                }
                
                .mode-btn:hover {
                    transform: translateY(-2px);
                    box-shadow: var(--shadow-md);
                }
                
                .prompt-section {
                    background: var(--glass-bg);
                    border: 1px solid var(--border-primary);
                    border-radius: 16px;
                    padding: 20px;
                    margin-bottom: 20px;
                }
                
                .style-presets .btn {
                    font-size: 12px;
                    padding: 6px 10px;
                }
                
                .upload-zone {
                    background: var(--glass-bg);
                    border: 2px dashed var(--border-primary);
                    border-radius: 12px;
                    padding: 16px;
                    text-align: center;
                    transition: var(--transition-normal);
                }
                
                .upload-zone:hover {
                    border-color: var(--accent-primary);
                    background: rgba(106, 163, 255, 0.05);
                }
                
                .video-result {
                    background: var(--glass-bg);
                    border: 1px solid var(--border-primary);
                    border-radius: 12px;
                    overflow: hidden;
                    transition: var(--transition-normal);
                }
                
                .video-result:hover {
                    border-color: var(--accent-primary);
                    transform: translateY(-2px);
                    box-shadow: var(--shadow-md);
                }
                
                .queue-item:hover {
                    background: var(--glass-bg) !important;
                    transform: translateX(4px);
                }
                
                .queue-item.active {
                    background: var(--accent-gradient) !important;
                    color: white !important;
                    box-shadow: var(--shadow-glow);
                }
                
                .video-player-container {
                    background: var(--glass-bg);
                    border: 1px solid var(--border-primary);
                    border-radius: 16px;
                    padding: 20px;
                }
                
                .player-controls {
                    background: var(--glass-bg);
                    border: 1px solid var(--border-primary);
                    border-radius: 12px;
                    padding: 12px;
                }
                
                .video-queue {
                    background: var(--glass-bg);
                    border: 1px solid var(--border-primary);
                    border-radius: 12px;
                    padding: 16px;
                    max-height: 400px;
                    overflow-y: auto;
                }
                
                .analysis-tools .btn {
                    justify-content: center;
                    text-align: center;
                }
                
                /* Custom scrollbar for video queue */
                .video-queue::-webkit-scrollbar {
                    width: 6px;
                }
                
                .video-queue::-webkit-scrollbar-track {
                    background: var(--bg-secondary);
                    border-radius: 3px;
                }
                
                .video-queue::-webkit-scrollbar-thumb {
                    background: var(--accent-primary);
                    border-radius: 3px;
                }
                
                .video-queue::-webkit-scrollbar-thumb:hover {
                    background: var(--accent-secondary);
                }
                
                /* Video progress bar styling */
                #videoProgress {
                    appearance: none;
                    height: 6px;
                    background: var(--bg-secondary);
                    border-radius: 3px;
                    outline: none;
                }
                
                #videoProgress::-webkit-slider-thumb {
                    appearance: none;
                    width: 16px;
                    height: 16px;
                    background: var(--accent-primary);
                    border-radius: 50%;
                    cursor: pointer;
                }
                
                #videoProgress::-moz-range-thumb {
                    width: 16px;
                    height: 16px;
                    background: var(--accent-primary);
                    border-radius: 50%;
                    cursor: pointer;
                    border: none;
                }
                
                @media (max-width: 768px) {
                    .video-player-container {
                        grid-template-columns: 1fr;
                        gap: 16px;
                    }
                    
                    .player-controls {
                        flex-wrap: wrap;
                    }
                    
                    .mode-buttons {
                        grid-template-columns: 1fr 1fr;
                    }
                    
                    .resolution-presets {
                        grid-template-columns: 1fr;
                    }
                }
            </style>
        `;
        
        document.head.insertAdjacentHTML('beforeend', videoStyles);
    </script>
</body>
</html>>
                </div>

                <!-- Video Results -->
                <div class="video-results" id="videoResults" style="display: none; margin-top: 24px;">
                    <h3>🎯 Generated Videos</h3>
                    <div class="video-grid" id="videoGrid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 16px;">
                    </div>
                </div>
            </div>

            <!-- Video Settings Panel -->
            <div class="card" style="grid-column: span 4;">
                <h2>⚙️ Video Settings</h2>

                <!-- Quality & Performance -->
                <div style="margin-bottom: 16px;">
                    <label>Quality Preset</label>
                    <select id="videoQuality" class="input">
                        <option value="FAST">⚡ Fast (4s, 12fps)</option>
                        <option value="BALANCED" selected>⚖️ Balanced (6s, 16fps)</option>
                        <option value="ULTRA">💎 Ultra (8s, 24fps)</option>
                        <option value="CUSTOM">🔧 Custom</option>
                    </select>
                </div>

                <!-- Video Parameters -->
                <div class="video-params">
                    <div class="grid" style="grid-template-columns: repeat(2, 1fr); gap: 12px;">
                        <div>
                            <label>Duration (seconds)</label>
                            <input id="videoDuration" class="input" type="number" value="6" min="2" max="10" step="0.5">
                            <input type="range" min="2" max="10" step="0.5" value="6" id="durationRange" style="width: 100%; margin-top: 4px;">
                        </div>
                        <div>
                            <label>Frame Rate (fps)</label>
                            <input id="videoFps" class="input" type="number" value="16" min="8" max="30">
                            <input type="range" min="8" max="30" value="16" id="fpsRange" style="width: 100%; margin-top: 4px;">
                        </div>
                        <div>
                            <label>Motion Strength</label>
                            <input id="motionStrength" class="input" type="number" step="0.1" value="0.8" min="0.1" max="2.0">
                            <input type="range" min="0.1" max="2.0" step="0.1" value="0.8" id="motionRange" style="width: 100%; margin-top: 4px;">
                        </div>
                        <div>
                            <label>Guidance Scale</label>
                            <input id="videoGuidance" class="input" type="number" step="0.1" value="7.5" min="1.0" max="20.0">
                            <input type="range" min="1.0" max="20.0" step="0.1" value="7.5" id="videoGuidanceRange" style="width: 100%; margin-top: 4px;">
                        </div>
                    </div>
                </div>

                <!-- Video Dimensions -->
                <div class="video-dimensions" style="margin-top: 16px;">
                    <label>📐 Video Resolution</label>
                    <div class="resolution-presets" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; margin-bottom: 8px;">
                        <button class="btn secondary" onclick="setVideoSize(1024, 576)">16:9 Wide</button>
                        <button class="btn secondary" onclick="setVideoSize(576, 1024)">9:16 Tall</button>
                        <button class="btn secondary" onclick="setVideoSize(768, 768)">1:1 Square</button>
                        <button class="btn secondary" onclick="setVideoSize(832, 448)">Cinematic</button>
                    </div>
                    <div class="grid" style="grid-template-columns: repeat(2, 1fr); gap: 8px;">
                        <div>
                            <label>Width</label>
                            <input id="videoWidth" class="input" type="number" value="1024" min="256" max="1024" step="64">
                        </div>
                        <div>
                            <label>Height</label>
                            <input id="videoHeight" class="input" type="number" value="576" min="256" max="1024" step="64">
                        </div>
                    </div>
                </div>

                <!-- Advanced Video Options -->
                <div class="advanced-video" style="margin-top: 20px;">
                    <details>
                        <summary style="cursor: pointer; padding: 8px; background: var(--glass-bg); border-radius: 8px;">
                            <strong>🔧 Advanced Options</strong>
                        </summary>
                        <div style="padding: 12px; margin-top: 8px;">
                            <div>
                                <label>Inference Steps</label>
                                <input id="videoSteps" class="input" type="number" value="25" min="10" max="50">
                            </div>
                            <div style="margin-top: 12px;">
                                <label>Noise Schedule</label>
                                <select id="noiseSchedule" class="input">
                                    <option value="default">Default</option>
                                    <option value="linear">Linear</option>
                                    <option value="cosine">Cosine</option>
                                    <option value="sqrt">Square Root</option>
                                </select>
                            </div>
                            <div style="margin-top: 12px;">
                                <label>Seed</label>
                                <div style="display: flex; gap: 4px;">
                                    <input id="videoSeed" class="input" type="number" placeholder="Random">
                                    <button class="btn secondary" onclick="randomVideoSeed()" style="padding: 8px;">🎲</button>
                                </div>
                            </div>
                            <div style="margin-top: 12px;">
                                <label>
                                    <input type="checkbox" id="loopVideo"> Loop Video
                                </label>
                            </div>
                            <div style="margin-top: 8px;">
                                <label>
                                    <input type="checkbox" id="upscaleVideo"> Upscale Output
                                </label>
                            </div>
                            <div style="margin-top: 8px;">
                                <label>
                                    <input type="checkbox" id="stabilizeMotion"> Motion Stabilization
                                </label>
                            </div>
                        </div>
                    </details>
                </div>

                <!-- Video Model Selection -->
                <div class="video-models" style="margin-top: 20px;">
                    <h3>🤖 Video Model</h3>
                    <div class="model-selector" id="videoModelSelector">
                        <div class="loading">Loading video models...</div>
                    </div>
                </div>

                <!-- Batch Generation -->
                <div style="margin-top: 20px;">
                    <label>📦 Batch Generation</label>
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <input id="videoBatchSize" class="input" type="number" value="1" min="1" max="4" style="width: 80px;">
                        <span style="font-size: 12px; color: var(--text-muted);">videos per batch</span>
                    </div>
                </div>

                <!-- Export Settings -->
                <div style="margin-top: 20px;">
                    <h3>📤 Export Settings</h3>
                    <div>
                        <label>Output Format</label>
                        <select id="outputFormat" class="input">
                            <option value="mp4">MP4 (H.264)</option>
                            <option value="webm">WebM (VP9)</option>
                            <option value="gif">GIF (Animated)</option>
                            <option value="frames">PNG Frames</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- Video Preview Section -->
        <div class="grid" style="margin-top: 24px;">
            <div class="card" style="grid-column: span 12;">
                <h2>🎥 Video Preview & Player</h2>
                
                <div class="video-player-container" style="display: grid; grid-template-columns: 2fr 1fr; gap: 24px;">
                    <!-- Main Player -->
                    <div class="main-player">
                        <video id="mainVideoPlayer" controls style="width: 100%; max-height: 400px; border-radius: 12px; background: #000;">
                            <source src="" type="video/mp4">
                            Your browser does not support the video tag.
                        </video>
                        
                        <!-- Player Controls -->
                        <div class="player-controls" style="margin-top: 12px; display: flex; gap: 8px; align-items: center;">
                            <button class="btn secondary" onclick="playPause()">⏯️</button>
                            <button class="btn secondary" onclick="resetVideo()">⏹️</button>
                            <button class="btn secondary" onclick="toggleLoop()">🔁</button>
                            <button class="btn secondary" onclick="toggleMute()">🔊</button>
                            <div style="flex: 1; margin: 0 12px;">
                                <input type="range" id="videoProgress" min="0" max="100" value="0" style="width: 100%;">
                            </div>
                            <button class="btn secondary" onclick="fullscreen()">⛶</button>
                        </div>
                    </div>

                    <!-- Video Queue -->
                    <div class="video-queue">
                        <h4>📋 Generated Videos</h4>
                        <div id="videoQueue" style="max-height: 300px; overflow-y: auto;">
                            <div class="empty-queue" style="text-align: center; padding: 40px; color: var(--text-muted);">
                                <div style="font-size: 32px; margin-bottom: 8px;">🎬</div>
                                <div>No videos generated yet</div>
                                <small>Generate your first video to see it here!</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Video Analysis Tools -->
                <div class="video-analysis" style="margin-top: 20px;">
                    <h4>📊 Video Analysis</h4>
                    <div class="analysis-tools" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px;">
                        <button class="btn secondary" onclick="analyzeMotion()">📈 Motion Analysis</button>
                        <button class="btn secondary" onclick="extractFrames()">🖼️ Extract Frames</button>
                        <button class="btn secondary" onclick="generateThumbnail()">📸 Thumbnail</button>
                        <button class="btn secondary" onclick="optimizeVideo()">⚡ Optimize</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="assets/app.js"></script>
    <script>
        // Enhanced Video Lab Functionality
        class VideoLab {
            constructor() {
                this.progressManager = new ProgressManager(document);
                this.progressManager.mount();
                this.jobBuilder = new JobBuilder();
                this.currentMode = 'txt2video';
                this.uploadedFiles = {};
                this.generatedVideos = [];
                this.currentVideoIndex = 0;
                
                this.setupEventListeners();
                this.setupVideoModelSelector();
                this.setupRangeSliders();
                this.selectVideoMode('txt2video');
            }

            setupEventListeners() {
                // Generation button
                document.getElementById('generateVideoBtn')?.addEventListener('click', () => {
                    this.generateVideo();
                });

                // Preview frame
                document.getElementById('previewFrameBtn')?.addEventListener('click', () => {
                    this.previewFrame();
                });

                // File uploads
                document.getElementById('sourceImageFile')?.addEventListener('change', (e) => {
                    this.handleFileUpload(e, 'sourceImage', 'sourceImagePreview');
                });

                document.getElementById('sourceVideoFile')?.addEventListener('change', (e) => {
                    this.handleFileUpload(e, 'sourceVideo', 'sourceVideoPreview');
                });

                document.getElementById('motionRefFile')?.addEventListener('change', (e) => {
                    this.handleFileUpload(e, 'motionRef', 'motionRefPreview');
                });

                // Quality preset change
                document.getElementById('videoQuality')?.addEventListener('change', (e) => {
                    this.applyVideoQualityPreset(e.target.value);
                });

                // Video player events
                const player = document.getElementById('mainVideoPlayer');
                if (player) {
                    player.addEventListener('loadedmetadata', () => {
                        document.getElementById('videoProgress').max = player.duration;
                    });

                    player.addEventListener('timeupdate', () => {
                        document.getElementById('videoProgress').value = player.currentTime;
                    });

                    document.getElementById('videoProgress')?.addEventListener('input', (e) => {
                        player.currentTime = e.target.value;
                    });
                }
            }

            setupRangeSliders() {
                // Sync video parameter sliders
                const sliders = [
                    { input: 'videoDuration', range: 'durationRange' },
                    { input: 'videoFps', range: 'fpsRange' },
                    { input: 'motionStrength', range: 'motionRange' },
                    { input: 'videoGuidance', range: 'videoGuidanceRange' }
                ];

                sliders.forEach(({input, range}) => {
                    const inputEl = document.getElementById(input);
                    const rangeEl = document.getElementById(range);
                    
                    if (inputEl && rangeEl) {
                        inputEl.addEventListener('input', () => {
                            rangeEl.value = inputEl.value;
                        });
                        
                        rangeEl.addEventListener('input', () => {
                            inputEl.value = rangeEl.value;
                        });
                    }
                });
            }

            async setupVideoModelSelector() {
                const container = document.getElementById('videoModelSelector');
                if (!container) return;

                try {
                    // Ensure modelManager is available
                    if (!window.modelManager) {
                        container.innerHTML = `
                            <div class="warning" style="text-align: center; padding: 16px; color: var(--warning);">
                                ⚠️ Model manager not available
                                <br><small>Please refresh the page</small>
                            </div>
                        `;
                        return;
                    }

                    await window.modelManager.loadModels();
                    
                    // Filter models suitable for video generation
                    const videoModels = window.modelManager.models.filter(m => 
                        m.group === 'video' && 
                        (m.tags.includes('txt2video') || m.tags.includes('img2video') || m.tags.includes('svd'))
                    );
                    
                    if (videoModels.length === 0) {
                        container.innerHTML = `
                            <div class="warning" style="text-align: center; padding: 16px; color: var(--warning);">
                                ⚠️ No video generation models found
                                <br><small>Please add SVD or AnimateDiff models to models/video/</small>
                            </div>
                        `;
                        return;
                    }

                    // Create model cards
                    const modelsHTML = videoModels.map(model => `
                        <div class="model-card ${model === videoModels[0] ? 'selected' : ''}" data-model="${model.name}">
                            <div class="model-header">
                                <h4>${model.name}</h4>
                                <div class="model-type">${model.type}</div>
                            </div>
                            <div class="model-info">
                                <div class="model-group">Video Model</div>
                                ${model.size_mb ? `<div class="model-size">${Math.round(model.size_mb)} MB</div>` : ''}
                            </div>
                            <div class="tags">
                                ${model.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                            </div>
                        </div>
                    `).join('');

                    container.innerHTML = modelsHTML;

                    // Add click handlers
                    container.querySelectorAll('.model-card').forEach(card => {
                        card.addEventListener('click', () => {
                            container.querySelectorAll('.model-card').forEach(c => c.classList.remove('selected'));
                            card.classList.add('selected');
                            window.modelManager.selectModel(card.dataset.model);
                            const statusElement = document.getElementById('videoModelStatus');
                            if (statusElement) {
                                statusElement.textContent = `Model: ${card.dataset.model}`;
                            }
                        });
                    });

                    // Select first model
                    window.modelManager.selectModel(videoModels[0].name);

                } catch (error) {
                    console.error('Failed to setup video model selector:', error);
                    container.innerHTML = '<div class="error">Failed to load video models</div>';
                }
            }

            selectVideoMode(mode) {
                this.currentMode = mode;
                
                // Update UI
                document.querySelectorAll('.mode-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.mode === mode);
                });

                // Show/hide upload sections
                const uploadsSection = document.getElementById('videoUploads');
                const sourceImageUpload = document.getElementById('sourceImageUpload');
                const sourceVideoUpload = document.getElementById('sourceVideoUpload');
                const motionRefUpload = document.getElementById('motionRefUpload');

                switch(mode) {
                    case 'txt2video':
                        uploadsSection.style.display = 'none';
                        break;
                    case 'img2video':
                        uploadsSection.style.display = 'block';
                        sourceImageUpload.style.display = 'block';
                        sourceVideoUpload.style.display = 'none';
                        motionRefUpload.style.display = 'none';
                        break;
                    case 'video2video':
                        uploadsSection.style.display = 'block';
                        sourceImageUpload.style.display = 'none';
                        sourceVideoUpload.style.display = 'block';
                        motionRefUpload.style.display = 'none';
                        break;
                    case 'motion_transfer':
                        uploadsSection.style.display = 'block';
                        sourceImageUpload.style.display = 'block';
                        sourceVideoUpload.style.display = 'none';
                        motionRefUpload.style.display = 'block';
                        break;
                }

                this.updateGenerationButton();
            }

            async handleFileUpload(event, type, previewId) {
                const file = event.target.files[0];
                if (!file) return;

                try {
                    const result = await fileManager.uploadFile(event.target, 'workspace');
                    this.uploadedFiles[type] = result;

                    // Show preview
                    const preview = document.getElementById(previewId);
                    if (preview && result) {
                        if (type.includes('Video') || type.includes('motion')) {
                            // Video preview
                            preview.innerHTML = `
                                <div class="file-preview" style="margin-top: 8px;">
                                    <video style="max-width: 100%; max-height: 80px; border-radius: 6px;" muted>
                                        <source src="${result.url}" type="video/mp4">
                                    </video>
                                    <div class="file-info" style="font-size: 12px; margin-top: 4px;">
                                        ${result.name} (${fileManager.formatFileSize(result.size)})
                                    </div>
                                </div>
                            `;
                        } else {
                            // Image preview
                            preview.innerHTML = `
                                <div class="file-preview" style="margin-top: 8px;">
                                    <img src="${result.url}" alt="${result.name}" style="max-width: 100%; max-height: 80px; border-radius: 6px;">
                                    <div class="file-info" style="font-size: 12px; margin-top: 4px;">
                                        ${result.name} (${fileManager.formatFileSize(result.size)})
                                    </div>
                                </div>
                            `;
                        }
                    }

                    toast.success(`📁 ${type} uploaded: ${result.name}`);
                    this.updateGenerationButton();

                } catch (error) {
                    toast.error(`Upload failed: ${error.message}`);
                }
            }

            applyVideoQualityPreset(quality) {
                const presets = {
                    FAST: { duration: 4, fps: 12, steps: 15, guidance: 7.5 },
                    BALANCED: { duration: 6, fps: 16, steps: 25, guidance: 7.5 },
                    ULTRA: { duration: 8, fps: 24, steps: 35, guidance: 9.0 }
                };

                const preset = presets[quality];
                if (!preset) return;

                document.getElementById('videoDuration').value = preset.duration;
                document.getElementById('durationRange').value = preset.duration;
                document.getElementById('videoFps').value = preset.fps;
                document.getElementById('fpsRange').value = preset.fps;
                document.getElementById('videoSteps').value = preset.steps;
                document.getElementById('videoGuidance').value = preset.guidance;
                document.getElementById('videoGuidanceRange').value = preset.guidance;
            }

            updateGenerationButton() {
                const generateBtn = document.getElementById('generateVideoBtn');
                if (!generateBtn) return;
                
                const prompt = document.getElementById('videoPrompt')?.value?.trim() || '';
                const hasRequiredFiles = this.hasRequiredFiles();
                const hasModel = window.modelManager?.selectedModel;

                const canGenerate = (prompt || this.currentMode !== 'txt2video') && hasRequiredFiles && hasModel;
                
                generateBtn.disabled = !canGenerate;
                generateBtn.textContent = canGenerate ? 
                    `🎬 Generate Video (${this.currentMode})` : 
                    '🚫 Missing Requirements';
            }

            hasRequiredFiles() {
                switch(this.currentMode) {
                    case 'txt2video':
                        return true;
                    case 'img2video':
                        return !!this.uploadedFiles.sourceImage;
                    case 'video2video':
                        return !!this.uploadedFiles.sourceVideo;
                    case 'motion_transfer':
                        return !!(this.uploadedFiles.sourceImage && this.uploadedFiles.motionRef);
                    default:
                        return false;
                }
            }

            buildVideoJobConfig() {
                const config = this.jobBuilder
                    .reset()
                    .setTask(this.currentMode)
                    .setPrompt(
                        document.getElementById('videoPrompt').value,
                        document.getElementById('videoNegative').value
                    )
                    .setQuality(document.getElementById('videoQuality').value)
                    .setModel(modelManager.selectedModel?.name)
                    .setSeed(document.getElementById('videoSeed').value ? 
                        parseInt(document.getElementById('videoSeed').value) : null)
                    .setBatchSize(parseInt(document.getElementById('videoBatchSize').value))
                    .setInputs({
                        width: parseInt(document.getElementById('videoWidth').value),
                        height: parseInt(document.getElementById('videoHeight').value),
                        duration: parseFloat(document.getElementById('videoDuration').value),
                        fps: parseInt(document.getElementById('videoFps').value),
                        steps: parseInt(document.getElementById('videoSteps').value),
                        guidance_scale: parseFloat(document.getElementById('videoGuidance').value),
                        motion_strength: parseFloat(document.getElementById('motionStrength').value),
                        loop: document.getElementById('loopVideo').checked,
                        upscale: document.getElementById('upscaleVideo').checked,
                        stabilize: document.getElementById('stabilizeMotion').checked,
                        output_format: document.getElementById('outputFormat').value
                    });

                // Add file paths
                if (this.uploadedFiles.sourceImage) {
                    config.setInput('image_path', this.uploadedFiles.sourceImage.path);
                }
                if (this.uploadedFiles.sourceVideo) {
                    config.setInput('video_path', this.uploadedFiles.sourceVideo.path);
                }
                if (this.uploadedFiles.motionRef) {
                    config.setInput('motion_ref_path', this.uploadedFiles.motionRef.path);
                }

                return config.build();
            }

            async generateVideo() {
                try {
                    const jobConfig = this.buildVideoJobConfig();
                    const job = await this.jobBuilder.setTask(jobConfig.task)
                        .setPrompt(jobConfig.prompt, jobConfig.negative)
                        .setQuality(jobConfig.quality)
                        .setModel(jobConfig.model_preference)
                        .setSeed(jobConfig.seed)
                        .setBatchSize(jobConfig.batch_size)
                        .setInputs(jobConfig.inputs)
                        .execute();

                    if (job) {
                        this.progressManager.connect(job.id, {
                            onCompleted: (message) => {
                                this.showVideoResults(message.job_id);
                                toast.success('🎬 Video generation completed!');
                            },
                            onFailed: () => {
                                toast.error('Video generation failed');
                            }
                        });

                        toast.info('🚀 Video generation started - this may take a few minutes...');
                    }

                } catch (error) {
                    toast.error(`Video generation failed: ${error.message}`);
                }
            }

            async previewFrame() {
                // Generate a single frame preview before full video
                toast.info('🖼️ Generating preview frame...');
                
                try {
                    const jobConfig = this.buildVideoJobConfig();
                    jobConfig.task = 'txt2img'; // Generate single frame
                    
                    const job = await this.jobBuilder.reset()
                        .setTask('txt2img')
                        .setPrompt(jobConfig.prompt, jobConfig.negative)
                        .setInputs({
                            width: jobConfig.inputs.width,
                            height: jobConfig.inputs.height,
                            steps: 20
                        })
                        .execute();

                    if (job) {
                        this.progressManager.connect(job.id, {
                            onCompleted: () => {
                                toast.success('🖼️ Preview frame generated!');
                            }
                        });
                    }
                    
                } catch (error) {
                    toast.error(`Preview failed: ${error.message}`);
                }
            }

            async showVideoResults(jobId) {
                try {
                    const job = await API.getJob(jobId);
                    
                    if (job.artifacts && job.artifacts.length > 0) {
                        const resultsSection = document.getElementById('videoResults');
                        const videoGrid = document.getElementById('videoGrid');
                        const videoQueue = document.getElementById('videoQueue');
                        
                        resultsSection.style.display = 'block';
                        
                        // Add to generated videos list
                        job.artifacts.forEach(artifact => {
                            const videoData = {
                                url: artifact,
                                jobId: jobId,
                                timestamp: Date.now(),
                                metadata: job.metadata
                            };
                            
                            this.generatedVideos.push(videoData);
                        });
                        
                        // Update video grid
                        const resultHTML = job.artifacts.map(artifact => `
                            <div class="video-result" style="position: relative;">
                                <video controls style="width: 100%; border-radius: 12px;" 
                                       onclick="loadVideoInPlayer('${artifact}')">
                                    <source src="${artifact}" type="video/mp4">
                                </video>
                                <div class="video-actions" style="position: absolute; top: 8px; right: 8px; display: flex; gap: 4px;">
                                    <button class="btn secondary" style="padding: 4px 8px; font-size: 12px;" onclick="Utils.downloadFile('${artifact}')">💾</button>
                                    <button class="btn secondary" style="padding: 4px 8px; font-size: 12px;" onclick="Utils.copyToClipboard('${window.location.origin}/${artifact}')">🔗</button>
                                </div>
                                <div class="video-info" style="padding: 8px; font-size: 12px;">
                                    <div>Job: ${jobId}</div>
                                    ${job.metadata?.seed ? `<div>Seed: ${job.metadata.seed}</div>` : ''}
                                </div>
                            </div>
                        `).join('');
                        
                        videoGrid.innerHTML += resultHTML;
                        
                        // Update video queue
                        this.updateVideoQueue();
                        
                        // Load first video in player
                        if (job.artifacts.length > 0) {
                            loadVideoInPlayer(job.artifacts[0]);
                        }
                        
                        // Scroll to results
                        resultsSection.scrollIntoView({ behavior: 'smooth' });
                    }
                    
                } catch (error) {
                    console.error('Failed to show video results:', error);
                }
            }

            updateVideoQueue() {
                const queue = document.getElementById('videoQueue');
                if (!queue || this.generatedVideos.length === 0) return;

                const queueHTML = this.generatedVideos.map((video, index) => `
                    <div class="queue-item ${index === this.currentVideoIndex ? 'active' : ''}" 
                         style="display: flex; gap: 8px; padding: 8px; border-radius: 8px; cursor: pointer; margin-bottom: 8px; ${index === this.currentVideoIndex ? 'background: var(--accent-gradient); color: white;' : 'background: var(--glass-bg);'}"
                         onclick="loadVideoInPlayer('${video.url}', ${index})">
                        <video style="width: 60px; height: 40px; object-fit: cover; border-radius: 4px;">
                            <source src="${video.url}" type="video/mp4">
                        </video>
                        <div style="flex: 1; min-width: 0;">
                            <div style="font-size: 12px; font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                                Video ${index + 1}
                            </div>
                            <div style="font-size: 10px; opacity: 0.8;">
                                ${new Date(video.timestamp).toLocaleTimeString()}
                            </div>
                        </div>
                    </div<!DOCTYPE html>
<html lang="de" data-theme="dark">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="AI Video Generation Lab - Text to Video, Image to Video, Motion Transfer">
    <title>Video Lab – AndioMediaStudio</title>
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><defs><linearGradient id=%22grad%22 x1=%220%%22 y1=%220%%22 x2=%22100%%22 y2=%22100%%22><stop offset=%220%%22 style=%22stop-color:%236aa3ff%22/><stop offset=%22100%%22 style=%22stop-color:%23b884ff%22/></linearGradient></defs><circle cx=%2250%22 cy=%2250%22 r=%2240%22 fill=%22url(%23grad)%22/></svg>">
    <link rel="stylesheet" href="assets/styles.css">
</head>
<body>
    <header class="header">
        <div class="brand">
            <span class="dot"></span>
            <span>Video Lab – AndioMediaStudio</span>
            <div class="badge nsfw">🎬 No Limits</div>
        </div>
        <nav>
            <a href="index.html">📊 Dashboard</a>
            <a href="create.html">🎨 Create</a>
            <a href="video.html" class="active">🎬 Video Lab</a>
            <a href="talking.html">💬 Talking</a>
            <a href="wardrobe.html">👔 Wardrobe</a>
            <a href="catalog.html">🏪 Store</a>
            <a href="gallery.html">🖼️ Gallery</a>
        </nav>
    </header>

    <main class="wrap">
        <div class="grid">
            <!-- Main Video Generation Panel -->
            <div class="card" style="grid-column: span 8;">
                <div class="flex">
                    <h2>🎬 AI Video Generation Studio</h2>
                    <div class="right">
                        <div class="badge success" id="videoModelStatus">SVD Ready</div>
                    </div>
                </div>
                
                <div id="progressHost"></div>

                <!-- Video Generation Modes -->
                <div class="video-modes" style="margin: 20px 0;">
                    <label>🚀 Video Generation Mode</label>
                    <div class="mode-buttons" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 12px;">
                        <button class="btn mode-btn active" data-mode="txt2video" onclick="selectVideoMode('txt2video')">
                            ✨ Text → Video
                            <small>Generate from description</small>
                        </button>
                        <button class="btn mode-btn" data-mode="img2video" onclick="selectVideoMode('img2video')">
                            🖼️ Image → Video
                            <small>Animate static image</small>
                        </button>
                        <button class="btn mode-btn" data-mode="video2video" onclick="selectVideoMode('video2video')">
                            🔄 Video → Video
                            <small>Transform existing video</small>
                        </button>
                        <button class="btn mode-btn" data-mode="motion_transfer" onclick="selectVideoMode('motion_transfer')">
                            🤸 Motion Transfer
                            <small>Copy movement patterns</small>
                        </button>
                    </div>
                </div>

                <!-- Prompt Section -->
                <div class="prompt-section">
                    <div>
                        <label>🎭 Video Prompt</label>
                        <textarea id="videoPrompt" class="input" rows="3" placeholder="Describe the video you want to create... A majestic eagle soaring through mountain valleys, cinematic drone shot, golden hour lighting..."></textarea>
                    </div>
                    
                    <div style="margin-top: 12px;">
                        <label>🚫 Negative Prompt</label>
                        <textarea id="videoNegative" class="input" rows="2" placeholder="static, blurry, low quality, distorted, artifacts..."></textarea>
                    </div>

                    <!-- Video Style Presets -->
                    <div class="style-presets" style="display: flex; gap: 8px; margin-top: 8px; flex-wrap: wrap;">
                        <button class="btn secondary" onclick="addVideoStyle('cinematic, movie scene, professional')">🎬 Cinematic</button>
                        <button class="btn secondary" onclick="addVideoStyle('drone shot, aerial view, smooth movement')">🚁 Drone</button>
                        <button class="btn secondary" onclick="addVideoStyle('slow motion, high fps, detailed')">⏱️ Slow-Mo</button>
                        <button class="btn secondary" onclick="addVideoStyle('time lapse, fast motion, dynamic')">⚡ Time-lapse</button>
                        <button class="btn secondary" onclick="addVideoStyle('nature documentary, wildlife, natural')">🌿 Nature</button>
                        <button class="btn secondary" onclick="addVideoStyle('abstract, artistic, creative motion')">🎨 Abstract</button>
                    </div>
                </div>

                <!-- File Upload Section -->
                <div class="video-uploads" id="videoUploads" style="display: none;">
                    <div class="card" style="background: var(--glass-bg); margin-top: 16px;">
                        <h3>📁 Video Assets</h3>
                        <div class="upload-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 16px;">
                            
                            <div class="upload-zone" id="sourceImageUpload">
                                <label>🖼️ Source Image</label>
                                <input type="file" id="sourceImageFile" accept="image/*" class="input">
                                <div class="upload-preview" id="sourceImagePreview"></div>
                                <div style="font-size: 11px; color: var(--text-muted); margin-top: 4px;">
                                    Best results: 1024×576 or 576×1024
                                </div>
                            </div>

                            <div class="upload-zone" id="sourceVideoUpload" style="display: none;">
                                <label>🎬 Source Video</label>
                                <input type="file" id="sourceVideoFile" accept="video/*" class="input">
                                <div class="upload-preview" id="sourceVideoPreview"></div>
                                <div style="font-size: 11px; color: var(--text-muted); margin-top: 4px;">
                                    Max duration: 10 seconds recommended
                                </div>
                            </div>

                            <div class="upload-zone" id="motionRefUpload" style="display: none;">
                                <label>🤸 Motion Reference</label>
                                <input type="file" id="motionRefFile" accept="video/*" class="input">
                                <div class="upload-preview" id="motionRefPreview"></div>
                                <div style="font-size: 11px; color: var(--text-muted); margin-top: 4px;">
                                    Reference movement pattern
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

                <!-- Generation Controls -->
                <div class="generation-controls" style="margin-top: 20px;">
                    <div class="toolbar">
                        <button class="btn" id="generateVideoBtn">
                            🎬 Generate Video
                        </button>
                        <button class="btn secondary" id="previewFrameBtn">
                            👁️ Preview Frame
                        </button>
                        <button class="btn secondary" onclick="randomizeVideoSettings()">
                            🎲 Random Settings
                        </button>
                        <button class="btn secondary" onclick="resetVideoSettings()">
                            🔄 Reset
                        </button>
                    </div